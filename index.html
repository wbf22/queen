<!DOCTYPE html>
<html lang="en" id="html" style="background-color: rgb(255, 255, 255); margin: 0px; padding: 0px; width: 100%;">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Website</title>
    <base target="_self">


    <style>
        #html {
            background-color: rgb(255, 255, 255);
            margin: 0px;
            padding: 0px;
        }

        #header {
            margin: 0px;
            background-color: rgb(224, 133, 215);
            padding: 1rem;
            display: flex;
            align-items: center;

        }

        #body {
            margin: 0px;
            padding: 0px;
            min-height: 100vh;
            font-family: Montserrat;
            color: rgb(224, 133, 215);
        }

        #main_section {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: rgb(224, 133, 215);
            background-color: #ffffff;
        }

        #element_47cef1bcf40b47b7 {
            border-radius: 5px;
            border: 2px solid rgb(224, 133, 215);
            height: 40vh;
            width: 60vw;
            margin: 2rem 0rem 1rem;
        }

        #element_b53e0e1d5ebd48ae {
            width: 60vw;
            display: flex;
            flex-direction: column;
        }

        #element_858cce4c95524e10 {
            padding: 1rem;
        }

        #element_0849c3d19e254d31 {
            padding: 1rem;
        }

        #element_9cfb296a35d9408c {
            padding: 1rem;
        }

        #element_5e845d77fbd34fcc {
            padding: 1rem;
        }

        #element_26cf65e584e24d92 {
            width: 60vw;
            margin: 2rem;
        }

        #element_f2868fccda224bd3 {
            display: grid;
            grid-template-columns: 1fr 4fr;
            width: 50vh;
        }

        #element_265b987ceb254fe9 {
            padding: 1rem;
        }

        #element_eb13771f5d5e49fd {
            padding: 1rem;
        }

        #temp_input {
            margin: 0px;
            padding: 0.5rem;
            place-self: center start;
            border: 2px solid rgb(224, 133, 215);
            border-radius: 5px;
        }


        #title {
            padding: 1rem;
            color: rgb(255, 255, 255);
        }

        #element_4693fc43131b4716 {
            padding: 1rem;
        }

        #element_c4ebd0ed321341be {
            padding: 1rem;
        }

        .date_select {
            padding: 1rem;
            margin: 1rem;
            border: 2px solid rgb(224, 133, 215);
            border-radius: 5px;
            width: 10rem;
            color: rgb(224, 133, 215);
        }

        #submit_event {
            padding: 0.5rem;
            background-color: rgb(224, 133, 215);
            width: 10rem;
            margin: 0rem 1rem;
            color: rgb(255, 255, 255);
            font-size: 1.2rem;
        }

        .pink_border {
            border: 2px solid rgb(224, 133, 215);
            border-radius: 5px;
            color: rgb(224, 133, 215);
            background-color: rgb(255, 255, 255);
        }

        #submit_temp {
            padding: 0.5rem;
            background-color: rgb(224, 133, 215);
            width: 10rem;
            margin: 0rem 1rem;
            color: rgb(255, 255, 255);
            font-size: 1.2rem;
        }

        #element_3d30a70ff1c4447d {
            display: flex;
            flex-direction: column;
        }

        #event_type_dropdown {
            padding: 1rem;
            background-color: rgb(255, 255, 255);
            border-radius: 5px;
            border: 2px solid rgb(224, 133, 215);
            color: rgb(224, 133, 215);
            margin: 0rem 1rem;
            width: 10rem;
        }

        #element_1f7656fec2654e5c {
            padding: 0.2rem;
            background-color: rgb(224, 133, 215);
            width: 4rem;
            margin: 0rem 2rem;
            color: rgb(255, 255, 255);
            align-self: end;
            font-size: 0.7rem;
        }


        #graph_canvas {
            
            height: 40vh;
            width: 60vw;
        }

        #temp_date_select {
            margin: 1rem 0rem;
        }


        @media (max-width: 1024px) {}
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com" id="preconnect1">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="" id="preconnect2">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&amp;display=swap"
        id="Montserrat">
</head>

<body id="body">

    <div id="header">
        <h1 id="title">Queen</h1>
        <svg width="3rem" height="3rem" viewBox="0 0 1024 1024" class="icon"  version="1.1" xmlns="http://www.w3.org/2000/svg"><path d="M978.254 300.427c0-44.771-36.295-81.066-81.066-81.066s-81.066 36.295-81.066 81.066c0 36.02 23.501 66.537 56 77.097-21.517 17.157-59.595 32.926-126.933 33.356-98.134 0.626-159.304-91.429-189.636-154.361 33.482-9.969 57.904-40.97 57.904-77.689 0-44.771-36.295-81.066-81.066-81.066s-81.066 36.295-81.066 81.066c0 36.404 23.999 67.203 57.038 77.443-31.165 62.724-93.137 154.607-188.769 154.607-73.523 0-114.78-18.623-137.64-37.145 27.448-12.988 46.441-40.925 46.441-73.307 0-44.771-36.295-81.066-81.066-81.066s-81.066 36.295-81.066 81.066c0 39.38 28.086 72.191 65.316 79.524-12.668 28.179-25.648 67.273-24.783 107.941l162.132 238.131c18.844 141.239 88.656 162.132 263.464 162.132 157.675 0 263.709-21.647 283.73-162.132l141.865-238.131c3.577-41.747-13.475-83.128-30.004-112.471 29.496-12.127 50.271-41.129 50.271-74.995zM491.787 178.828c0-22.427 18.179-40.606 40.606-40.606 22.427 0 40.606 18.179 40.606 40.606 0 22.427-18.179 40.606-40.606 40.606-22.427 0-40.606-18.179-40.606-40.606zM106.724 300.427c0-22.427 18.179-40.606 40.606-40.606 22.427 0 40.606 18.179 40.606 40.606 0 22.427-18.179 40.606-40.606 40.606-22.427 0-40.606-18.179-40.606-40.606zM775.59 726.022c-18.779 120.741-102.206 121.349-243.197 121.599-156.909 0.278-202.91 7.105-222.931-121.599L145.488 488.854c-1.113-56.179 19.344-97.228 19.344-97.228s21.993 57.759 154.763 57.759S532.392 295.36 532.392 295.36s98.177 154.025 212.798 154.025 154.763-57.759 154.763-57.759 19.344 40.685 19.344 96.266L775.59 726.022z m121.598-384.989c-22.427 0-40.606-18.179-40.606-40.606 0-22.427 18.179-40.606 40.606-40.606 22.427 0 40.606 18.179 40.606 40.606 0 22.427-18.179 40.606-40.606 40.606z" fill="#ffffff" /></svg>
    </div>

    <div id="main_section">
        <div id="element_3d30a70ff1c4447d">
            <div id="element_47cef1bcf40b47b7">
                <canvas id="graph_canvas"></canvas>
            </div>
            <button id="element_1f7656fec2654e5c" class="pink_border">download</button>
        </div>
        <div id="element_b53e0e1d5ebd48ae">
            <h2 id="element_7e557ad4033c45e2">Log Event</h2>
            <select id="event_type_dropdown">
                <option id="element_858cce4c95524e10" value="very_heavy_bleeding">very heavy bleeding</option>
                <option id="element_0849c3d19e254d31" value="heavy_bleeding">heaving bleeding</option>
                <option id="element_0849c3d19e254d31" value="medium_bleeding">medium bleeding</option>
                <option id="element_0849c3d19e254d31" value="light_bleeding">light bleeding</option>
                <option id="element_c4ebd0ed321341be" value="spotting">spotting</option>
                <option id="element_4693fc43131b4716" value="positive_pregnancy_test">positive pregnancy test</option>
                <option id="element_4693fc43131b4716" value="faintly_positive_pregnancy_test">faintly positive pregnancy test</option>
                <option id="element_4693fc43131b4716" value="negative_pregnancy_test">negative pregnancy test</option>
                <option id="element_4693fc43131b4716" value="fatigue">fatigue</option>
                <option id="element_4693fc43131b4716" value="tender_breasts">tender breasts</option>
                <option id="element_4693fc43131b4716" value="cramps">cramps</option>
                <option id="element_4693fc43131b4716" value="positive_ovulation_test">positive ovulation test</option>
                <option id="element_4693fc43131b4716" value="faintly_positive_ovulation_test">faintly positive ovulation test</option>
                <option id="element_4693fc43131b4716" value="negative_ovulation_test">negative ovulation test</option>
                <option id="element_4693fc43131b4716" value="sick">sick</option>
                <option id="element_4693fc43131b4716" value="stress">stress</option>
            </select>
            <input id="event_date_select" class="date_select" type="date">
            <button id="submit_event" class="pink_border">Submit</button>
        </div>
        <div id="element_26cf65e584e24d92">
            <h2 id="element_fde29288b6384ae3">Log Basal Body Temperature</h2>
            <div id="element_f2868fccda224bd3">
                <p id="element_265b987ceb254fe9">Temp</p>
                <input id="temp_input" type="">
                <p id="element_eb13771f5d5e49fd">Date</p>
                <input id="temp_date_select" class="date_select" type="date">
                <button id="submit_temp" class="pink_border">Submit</button>
            </div>
        </div>
    </div>





    <!-- general -->
    <script>

        let bb_temperatures = new Map();
        let events = new Map();
        let START_DATE = new Date(2025, 12 - 1, 1);
        let END_DATE = new Date(2026, 3 - 1, 1);

        let event_type_dropdown = document.getElementById("event_type_dropdown");
        let submit_event = document.getElementById("submit_event");
        let submit_temp = document.getElementById("submit_temp");
        let graph_canvas = document.getElementById("graph_canvas");
        const ctx = graph_canvas.getContext('2d');


        
        submit_event.addEventListener("click", () => {

            // add to graph
            const date = time_less_date_from_calendar(document.getElementById("event_date_select"));
            events.set(
                date_to_str(date),
                event_type_dropdown.value
            )
            draw_graph(START_DATE, END_DATE, bb_temperatures, events);


            // add to local storage
        });
        submit_temp.addEventListener("click", () => {
            
            const temp = parseFloat(document.getElementById("temp_input").value);
            const date = time_less_date_from_calendar(document.getElementById("temp_date_select"));
            

            // add to graph
            bb_temperatures.set(
                date_to_str(date),
                temp
            );
            draw_graph(START_DATE, END_DATE, bb_temperatures, events);

            // add to local storage

        });



    </script>


    <!-- util -->
    <script>
        function date_to_str(date) {
            const options = { month: 'numeric', day: 'numeric', year: 'numeric' };
            return new Intl.DateTimeFormat('en-US', options).format(date);
        }
    
        function time_less_date_from_calendar(input) {
            const [year, month, day] = input.value.split('-').map(Number);
            return new Date(year, month - 1, day);
        }
    </script>


    <!-- graph -->
    <script>
        function draw_graph(start_date, end_date, bb_temperatures, events) {
            // clear graph
            const rect = graph_canvas.getBoundingClientRect();
            graph_canvas.width = rect.width;
            graph_canvas.height = rect.height;
            ctx.clearRect(0, 0, graph_canvas.width, graph_canvas.height);

            // determine x step
            const DAY_IN_MS = 1000 * 60 * 60 * 24;
            const num_days = (end_date - start_date) / DAY_IN_MS;
            const step_x = graph_canvas.width / num_days;

            // determine temp y step
            let min_temp = bb_temperatures.size == 0? 96 : bb_temperatures.values().next().value;
            let max_temp = bb_temperatures.size == 0? 100 : bb_temperatures.values().next().value;
            for (let temp of bb_temperatures.values()) {
                if (temp < min_temp) {
                    min_temp = temp;
                }
                if (temp > max_temp) {
                    max_temp = temp;
                }
            }
            max_temp = min_temp == max_temp? min_temp + 2 : max_temp;
            const Y_MARGIN = graph_canvas.height * .2;
            const step_y = (graph_canvas.height - 2*Y_MARGIN) / (max_temp-min_temp);

            // determine last temp
            let last_date = null;
            let last_temp = null; 
            for (let key of bb_temperatures.keys()) {
                const key_date = new Date(key);
                if (start_date > key_date) {
                    if (last_date == null) {
                        last_date = key_date;
                        last_temp = bb_temperatures.get(key);
                    }
                    else if (start_date - last_date > start_date - key_date) {
                        last_date = key_date;
                        last_temp = bb_temperatures.get(key);
                    }
                }
            }
            let last_temp_y = last_temp? graph_canvas.height - Y_MARGIN - step_y * (last_temp - min_temp) : null;
            let last_temp_x = 0;

            // walk through dates drawing
            let curr_date = new Date(start_date);
            let i = 0;
            while (curr_date < end_date) {

                // draw line if 1st day of the month
                let x = step_x * i;
                if (curr_date.getDate() == 1) {
    
                    ctx.beginPath();
                    ctx.moveTo(x, 0);
                    ctx.lineTo(x, graph_canvas.height);
                    ctx.strokeStyle = 'rgb(200, 200, 200)';
                    ctx.lineWidth = 1;
                    ctx.stroke();

                    const options = { month: 'short', year: 'numeric' };
                    const formatted = new Intl.DateTimeFormat('en-US', options).format(curr_date);
                    ctx.font = '20px Arial';
                    ctx.fillStyle = 'rgb(200, 200, 200)';
                    ctx.fillText(formatted, x + 5, graph_canvas.height - 20);
                }

                // draw temperature for this day
                const date_str = date_to_str(curr_date);
                if (bb_temperatures.has(date_str)) {
                    let temp = bb_temperatures.get(date_str);
                    let y = graph_canvas.height - Y_MARGIN - step_y * (temp - min_temp);
                    ctx.beginPath();
                    ctx.arc(x, y, 2.5, 0, Math.PI * 2); // full circle
                    ctx.fillStyle = 'rgb(224, 133, 215)'; // color of the dot
                    ctx.fill();
    
                    if (last_temp_y) {
                        ctx.beginPath();
                        ctx.moveTo(last_temp_x, last_temp_y);
                        ctx.lineTo(x, y);
                        ctx.strokeStyle = 'rgb(224, 133, 215)';
                        ctx.lineWidth = 3;
                        ctx.stroke();
                    }
                    last_temp_x = x;
                    last_temp_y = y;
                }

                // draw events for this day
                if (events.has(date_str)) {

                    let type = events.get(date_str);
                    if (type.includes("bleeding") || type.includes("spotting")) {

                        let strength = 0.5;
                        if (type == "very_heavy_bleeding") {
                            strength = 0.5;
                        }
                        else if (type == "heavy_bleeding") {
                            strength = 0.4;

                        }
                        else if (type == "medium_bleeding") {
                            strength = 0.3;

                        }
                        else if (type == "light_bleeding") {
                            strength = 0.2;
                            
                        }
                        else if (type == "spotting") {
                            strength = 0.1;
                        }

                        ctx.fillStyle = `rgba(224, 133, 215,${strength})`;
                        ctx.fillRect(x, Y_MARGIN, step_x, graph_canvas.height - 2*Y_MARGIN);

                    }

                    // ctx.font = '20px Arial';
                    // ctx.fillStyle = 'rgb(200, 200, 200)';
                    // ctx.fillText(events.get(date_str), x + 5, 20);
                }

                i++;
                curr_date.setDate(curr_date.getDate() + 1);
            }


        }
        draw_graph(START_DATE, END_DATE, bb_temperatures, events);

    </script>





</body>

</html>